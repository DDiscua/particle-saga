<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ParticleSaga.js</title>
    <meta name="description" content="A Three.js WebGL particle gallery for models and images">
    <meta name="keywords" content="particles, webgl, threejs, three.js, javascript">
    <link href='http://fonts.googleapis.com/css?family=Josefin+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" href="examples/images/favicon.ico"></link>
    <link href="examples/css/reset.css" rel="stylesheet" type="text/css">
    <link href="examples/css/styles.css" rel="stylesheet" type="text/css">

    <meta property="og:image" content="http://blakecarroll.github.io/particle-saga/examples/images/share.jpg">
    <meta property="og:title" content="ParticleSaga.js">
    <meta property="og:description" content="A Three.js WebGL particle gallery for models and images">
    <meta property="og:url" content="http://blakecarroll.github.io/particle-saga/">
    <meta property="og:site_name" content="particlesaga.js">
  </head>

  <body>
    <div id="saga">
      <h1>ParticleSaga.js</h1>
      <footer>
        <div id="upload-indicator">
          <h4 class="drop-text">Drop Anywhere!</h4>
          <h4>Drag your own files onto the page</h4>
          <p>Images and three.js json models are dandy</p>
        </div>
        <nav>
          <a class="github" href="https://github.com/blakecarroll/particle-saga">Github</a>
          <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fblakecarroll.github.io%2Fparticle-saga%2F&amp;width&amp;layout=button&amp;action=like&amp;show_faces=false&amp;share=false&amp;height=20" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:20px;" allowTransparency="true"></iframe>
        </nav>
      </footer>
      <ul id="multitarget-references">
        <li id="multitarget-reference-1"></li>
        <li id="multitarget-reference-2"></li>
        <li id="multitarget-reference-3"></li>
        <li id="multitarget-reference-4"></li>
      </ul>
      <nav class="pagination">
        <button class="prev">Prev</button>
        <button class="next">Next</button>
      </nav>
      <div id="drag-screen"></div>
    </div>


    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>
    <script type="text/javascript" src="deploy/particlesaga.js"></script>
    <script type="text/javascript">

      /**
       * Declaring particles targets:
       * Here we have 2 models, 2 images, and a MultiTarget collection
       * of the same models and images again.
       */
      var targets = [
        {
          type: ParticleSaga.ModelTarget,
          url: './examples/models/helmet.json',
          options: {
            color: {
              r: 0.8,
              g: 1,
              b: 1
            },
            scale: 110,
            size: 3,
            respondsToMouse: true
          }
        }, {
          type: ParticleSaga.ImageTarget,
          url: './examples/images/griffin.png',
          options: {
            respondsToMouse: true,
            size: 3
          }
        }, {
          type: ParticleSaga.ModelTarget,
          url: './examples/models/gryphon.json',
          options: {
            color: {
              r: 0.8,
              g: 1,
              b: 0.2
            },
            size: 3,
            scale: 120,
            respondsToMouse: true,
            initialMatrices: [
              new THREE.Matrix4().makeTranslation(0,-2, 0),
              new THREE.Matrix4().makeRotationY(Math.PI/2)
            ]
          }
        }, {
          type: ParticleSaga.ImageTarget,
          url: './examples/images/saga.png',
          options: {
            respondsToMouse: true,
            size: 2
          }
        }, {
          type: ParticleSaga.MultiTarget,
          container: document.getElementById('multitarget-references'),
          options: {
            size: 3,
            respondsToMouse: true
          },
          targets: [
            {
              type: ParticleSaga.ModelTarget,
              url: './examples/models/helmet.json',
              container: document.getElementById('multitarget-reference-1'),
              options: {
                scale: 40,
                color: {
                  r: 0.8,
                  g: 1,
                  b: 1
                },
                initialMatrices: [
                  new THREE.Matrix4().makeTranslation(0.1, -0.4, 0)
                ]
              }
            },
            {
              type: ParticleSaga.ModelTarget,
              url: './examples/models/gryphon.json',
              container: document.getElementById('multitarget-reference-2'),
              options: {
                scale: 60,
                color: {
                  r: 0.8,
                  g: 1,
                  b: 0.2
                },
                initialMatrices: [
                  new THREE.Matrix4().makeTranslation(0,-2, 0),
                  new THREE.Matrix4().makeRotationY(Math.PI/2)
                ]
              }
            }, {
              type: ParticleSaga.ImageTarget,
              url: './examples/images/saga.png',
              container: document.getElementById('multitarget-reference-3')
            }, {
              type: ParticleSaga.ImageTarget,
              url: './examples/images/griffin.png',
              container: document.getElementById('multitarget-reference-4')
            }
          ]
        }
      ];

      function setupDemoUI() {
        setupDragEvents();
        setupPagination();
        fadeIn();
      }

      function fadeIn() {
        saga.className += ' loaded';
      }

      function setupPagination() {
        var next = document.getElementsByClassName('next')[0];
        var prev = document.getElementsByClassName('prev')[0];
        next.addEventListener('click', scene.nextTarget);
        prev.addEventListener('click', scene.prevTarget);
        document.body.addEventListener('keydown', onKeydown);
      }

      function onKeydown(e) {
        switch(e.keyCode) {
          case 37:
            scene.prevTarget();
            break;
          case 39:
            scene.nextTarget();
            break;
        }
      }

      function setupDragEvents() {
        var dragScreen = document.getElementById('drag-screen');
        saga.addEventListener('dragenter', function() {
          saga.className += ' dragover';
        });
        dragScreen.addEventListener('dragleave', function(event) {
          saga.className = saga.className.replace(/dragover/g, '');
        });
        saga.addEventListener('drop', onFileDrop);

        window.addEventListener('dragover', function(event) {
          event.preventDefault();
        });
        window.addEventListener('drop', function(event) {
          event.preventDefault();
        });
      }

      function onFileDrop(event) {
        event.preventDefault();
        saga.className = saga.className.replace(/dragover/g, '');
        var validImageTypes = ['image/jpeg', 'image/jpg', 'image/png'];
        var validModelTypes = ['application/json', 'text/javascript', 'application/x-javascript'];
        var files = event.dataTransfer.files;
        for (var i=0; i<files.length; i++) {
          var file = files[i];
          var type;

          if (validImageTypes.indexOf(file.type) != -1) {
            type = 'image';
          } else if (validModelTypes.indexOf(file.type) != -1) {
            type = 'model';
          } else {
            continue;
          }

          var reader = new FileReader();
          reader.addEventListener('loadend', function(event) {
            onFileLoad(this.result);
          });

          if (type === 'image') {
            reader.readAsDataURL(file);
          } else {
            reader.readAsText(file);
          }
        }
        return false;
      }

      function onFileLoad(result) {
        var target = {
          options: {
            respondsToMouse: true,
            size: 3
          }
        };

        if (result.match(/^data:image/)) {
          target.type = ParticleSaga.ImageTarget;
          var img = document.createElement("img");
          img.src = result;
          target.url = result;
        } else {
          target.type = ParticleSaga.ModelTarget;
          target.preloadedVertices = JSON.parse(result).vertices;
          target.options.color = {
            r: Math.random(),
            g: Math.random(),
            b: Math.random()
          }
        }
        var incomingIndex = scene.targets.length;
        scene.loadTarget(target, function() {
          scene.setTarget(incomingIndex, true);
        })
      }

      // Start the scene
      var saga = document.getElementById('saga');
      var scene = new ParticleSaga.Scene(saga, targets, {
        numParticles: 40000,
        numFloatingParticles: 200,
        sort: ParticleSaga.VertexSort.leftToRight
      });
      scene.load(function() {
        setupDemoUI();
        setTimeout(function() {
          scene.setTarget(0);
          scene.startSlideshow();
        }, 800);
      });
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-50562331-1', 'blakecarroll.github.io');
      ga('send', 'pageview');

    </script>
  </body>
</html>
